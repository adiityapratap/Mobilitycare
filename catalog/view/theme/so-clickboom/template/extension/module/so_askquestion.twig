{# Ask Question Modal #}
<style>
.form-group{
    margin-bottom: 0px !important;
}
</style>
<div id="askQuestionModal" class="modal fade" tabindex="-1" role="dialog" style="width: 500px;left: 500px;">
  <div class="modal-dialog modal-md">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Find a local dealer</h4>
      </div>

      <div class="modal-body">
        <form id="askQuestionForm">
          <input type="hidden" name="isAjax" value="1">
          <input type="hidden" name="product_id" value="{{ product_id|default(0) }}">

         
         <div class="form-group">
            <label>Name *</label>
            <input type="text" name="name" id="customerName" class="form-control">
          </div>
         

          <div class="form-group">
            <label>Email *</label>
            <input type="email" name="email" id="customerEmail" class="form-control" required>
          </div>

          
          <div class="form-group">
            <label>Phone *</label>
            <input type="text" name="phone" id="customerPhone" class="form-control phoneValidate">
          </div>
         
         

          <div class="form-group">
            <label>Postcode *</label>
            <input type="text" name="postcode" class="form-control postcodeValidate">
          </div>

          <div class="form-group">
            <label>State</label>
            <input type="text" name="state" class="form-control">
          </div>

         
          <div class="form-group">
            <label>Message</label>
            <textarea name="message" class="form-control"></textarea>
          </div>
         

          <button type="submit" class="btn btn-primary btn-block">
            Submit
          </button>
        </form>
      </div>

    </div>
  </div>
</div>
<!-- Loader -->
<div id="askQuestionLoader"
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.4); z-index:1051;">
  <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
              background:#fff; padding:20px 30px; border-radius:4px;">
    <i class="fa fa-spinner fa-spin"></i> Please wait...
  </div>
</div>

<div id="toastMessageAsk"
     style="display:none; position:fixed; bottom:20px; left:50%;
            transform:translateX(-50%); z-index:9999;"
     class="alert alert-success">
</div>

<script>
(function ($) {

  function showLoader() {
      $("#askQuestionLoader").fadeIn(200);
  }

  function hideLoader() {
      $("#askQuestionLoader").fadeOut(200);
  }

  function showToast(message, type = 'success') {
      var toast = $("#toastMessageAsk");
      toast
        .removeClass("alert-success alert-danger")
        .addClass(type === 'success' ? 'alert-success' : 'alert-danger')
        .html(message)
        .fadeIn();

      setTimeout(function () {
          toast.fadeOut();
      }, 3000);
  }

  function validateForm() {
       var name  = $.trim($("#customerName").val());
      var email = $.trim($("#customerEmail").val());
      var phone = $.trim($("#customerPhone").val());

      if (name === "") {
          showToast("Name is required", "error");
          return false;
      }
      if (email === "") {
          showToast("Email is required", "error");
          return false;
      }
      if (phone === "") {
          showToast("Phone is required", "error");
          return false;
      }
      return true;
  }

  // Open modal + loader
  $(document).on("click", "#so_askquestion_product", function (e) {
      e.preventDefault();
      showLoader();
      $("#askQuestionModal").modal("show");

      setTimeout(function () {
          hideLoader();
      }, 300);
  });

  // Submit form
  $(document).on("submit", "#askQuestionForm", function (e) {
      e.preventDefault();

      if (!validateForm()) {
          return;
      }

      showLoader();

      $.ajax({
          url: "index.php?route=extension/module/so_askquestion/sendData",
          type: "POST",
          data: $(this).serialize(),
          dataType: "json",
          success: function (res) {
              hideLoader();

              if (res.status === 1) {
                  $("#askQuestionModal").modal("hide");
                  showToast(res.success, "success");
                  $("#askQuestionForm")[0].reset();
              } else if (res.errors) {
                  showToast(res.errors.map(e => e.error).join("<br>"), "error");
              }
          },
          error: function () {
              hideLoader();
              showToast("Something went wrong. Please try again.", "error");
          }
      });
  });

})(jQuery);
</script>

